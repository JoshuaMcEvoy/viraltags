<body onload="initialize()">
  <div class="container">
    <div id="earth_div">
      <div id="buttons">
        <input type="button" value="Zoom to level 1" onclick="setView(1);">
        <input type="button" value="Zoom to level 2" onclick="setView(2);">
        <input type="button" value="Zoom to level 3" onclick="setView(3);">
        <input type="button" value="Zoom to level 4" onclick="setView(4);">
        <input type="button" value="Zoom to level 5" onclick="setView(5);">
      </div>
    </div>
  </div>
</body>
<script src="http://www.webglearth.com/v2/api.js"></script>
<script>
  let earth;
  function initialize() {
    var options = {
          sky: true,
          dragging: true,
          tilting: true,
          zoom: 2
        };
    earth = new WE.map('earth_div', options);
    WE.tileLayer('http://tileserver.maptiler.com/nasa/{z}/{x}/{y}.jpg', {
          minZoom: 0,
          maxZoom: 5,
          attribution: 'NASA'
        }).addTo(earth);
    earth.setView([<%= @lat %>, <%= @lng %>], 2);
    var tweets = <%== @tweet_locations.to_json %>;
    tweets.forEach(function(tweet) {
      var [message, lat, lng] = tweet
      var marker = WE.marker([lat, lng], '/assets/Twitter.png', 30, 30).addTo(earth);
      marker.bindPopup(message);
      marker.on('mouseover', function(e) {
        console.log(e);
        console.log(this);
        marker.openPopup();
      });
      marker.on('mouseout', function(e) {
        marker.closePopup();
      });
    })
  }
  const setView = function(zoom) {
    earth.setView([<%= @lat %>, <%= @lng %>], zoom);
  }
</script>
